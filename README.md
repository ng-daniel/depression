# Machine Learning for Detecting Depression from Motion Data

This repo is all the machine learning pipelines and code I wrote in Python for rapid experimentation of various machine learning models and preprocessing techniques.
I learned so much through this project, and if you want the details and a couple figures, it's all here so go ham.

TODO:

- Analysis Charts
- Results Charts
- Writing ReadME.md

For the short version, this project is about relationship between physical movement patterns and depression, and trying to detect this with machine learning. The dataset, called "Depresjon", contains motion data from 55 subjects-- some depressed, some non-depressed(Enrique et al).

After confirming that there is at least _some_ difference between the classes so I'm not completely wasting my time, I split the data using **5 fold** cross validation, **preprocessed** data for model input, **trained** various models on the data, and **evaluated** their respective performance.

In the end, I was able to beat the "Depresjon" paper's baseline results, improving on both accuracy and f1score. It wasn't by much, but a win is a win :) and I've tinkered with this repo for way too long so I'm leaving it at that.

Future work could be to explore different features for the data or to develop a lightweight application where users can upload their own data and figure out their likelihood of having depression based on the models.

## File structure

```
depression
├───core                    // functions for core operations
│
├───data                    // raw data files and fold information
│   ├───condition               // depressed data from Depresjon
│   ├───control                 // non-depressed data from Depresjon
│   └───processed_dataframes
│       └───kfolds                  // .txt files with sample names
│                                      for train(t) and eval(e) folds
│
├───figures                 // look at these photographs
│───results                 // .csv files of experiment and final results
│
│───analysis.py
└
```

## You're Telling Me A Pipeline Preprocessed This Data?

The Depresjon Dataset consists of 55 subjects, with an average of 12-13 days of data each. The data is recorded in minute intervals. Here's a `.csv` snippet of the control_1 subject:

| timestamp           | date       | activity |
| ------------------- | ---------- | -------- |
| 2003-03-18 15:00:00 | 2003-03-18 | 60       |
| 2003-03-18 15:01:00 | 2003-03-18 | 0        |
| 2003-03-18 15:02:00 | 2003-03-18 | 264      |
| 2003-03-18 15:03:00 | 2003-03-18 | 662      |
| 2003-03-18 15:04:00 | 2003-03-18 | 293      |

The `timestamp` and `date` columns are self explanatory, but the `activity` column needs some more info. During data collection, subjects wore a motion traching watch that sampled at 32 hz for movements above 0.05 g, or ~0.5 m/s(Enrique et al). The `activity` column records the number of recorded movements for the duration of that minute.

Challenges with the dataset:

1. **Small Dataset**. With only ~700 labeled samples and 1440 datapoints each, the big-picture trends are harder to detect.
2. **Imbalanced Classes**. 32 control subjects v.s. only 23 condition subjects means models lean towards the majority class.
3. **Noisy Data**. On a minute level, movement patterns throughout the day are very erratic and hinder model predictions.

Preprocessing Pipeline

## References That I Definitely Didn't Make Up

1. Enrique Garcia-Ceja, Michael Riegler, Petter Jakobsen, Jim Tørresen, Tine Nordgreen, Ketil J. Oedegaard, and Ole Bernt Fasmer. 2018. Depresjon: a motor activity database of depression episodes in unipolar and bipolar patients. In Proceedings of the 9th ACM Multimedia Systems Conference (MMSys '18). Association for Computing Machinery, New York, NY, USA, 472–477. https://doi.org/10.1145/3204949.3208125

2. Chawla, Nitesh V., Kevin W. Bowyer, Lawrence O. Hall, and W. Philip Kegelmeyer. "SMOTE: synthetic minority over-sampling technique." Journal of artificial intelligence research 16 (2002): 321-357. https://doi.org/10.1613/jair.953

3. Ashford, J., Bird, J.J., Campelo, F., Faria, D.R. (2020). Classification of EEG Signals Based on Image Representation of Statistical Features. In: Ju, Z., Yang, L., Yang, C., Gegov, A., Zhou, D. (eds) Advances in Computational Intelligence Systems. UKCI 2019. Advances in Intelligent Systems and Computing, vol 1043. Springer, Cham. https://doi.org/10.1007/978-3-030-29933-0_37

,model_name,note,loss,acc,prec0,prec1,rec0,rec1,f1sc0,f1sc1,sup0,sup1,mcc
5,ConvNN,1_wt_avg,0.5689755493402481,0.717477159500122,0.7880810502920678,0.6571341914545965,0.7071215781306854,0.7361822675224737,0.7355969813355235,0.6825860868178942,80.49748743718592,60.49828178694158,0.4358078374963946
5,ConvNN,2_wt_avg,0.5429431313276291,0.7275247800350189,0.780839740566707,0.6752597520130474,0.7145399018530695,0.7453284396689489,0.7395940187647291,0.6981217042774378,80.49748743718592,60.49828178694158,0.4485501272343841
5,ConvNN,3_wt_avg,0.5422741621732711,0.7319990622997283,0.8176643108985456,0.641019815999788,0.7343776926910474,0.5528042192293254,0.7616309858846091,0.6585637430902934,80.49748743718592,60.49828178694158,0.44656689372055025
5,ConvNN,4_wt_avg,0.5458958548307419,0.7408549779653549,0.8034615883416152,0.693378595945303,0.7394261706947816,0.7529500939625099,0.7610549720672999,0.7084891906011295,80.49748743718592,60.49828178694158,0.4856378287635019
5,ConvNN,5_wt_avg,0.5351043540239334,0.7297935116291046,0.8107088345197495,0.6714010729528905,0.7229314368107309,0.7536651139086427,0.7534125623133547,0.6951966668873467,80.49748743718592,60.49828178694158,0.47298033008280055
5,ConvNN,6_wt_avg,0.5570588743686675,0.7267858475446701,0.8084564805821826,0.6383416741396856,0.7208044714377293,0.7286696002826991,0.7545098357958967,0.6702131817682754,80.49748743718592,60.49828178694158,0.44104466099988554
5,ConvNN,7_wt_avg,0.5241420832276344,0.7509003829956054,0.8036521980533945,0.7108709655866625,0.7615409794647718,0.7403288829850382,0.7744533021200902,0.7124148705147049,80.49748743718592,60.49828178694158,0.49776582804380337
5,ConvNN,8_wt_avg,0.5389499175548553,0.7375370281934738,0.8054597543732787,0.6560276747935935,0.7372774645080251,0.7200403147825829,0.7614997220575239,0.6717614684543998,80.49748743718592,60.49828178694158,0.4508465488422314
5,ConvNN,9_wt_avg,0.527009313106537,0.7457321155071258,0.8231732393710105,0.6891192974994961,0.7343166951615263,0.769196163538189,0.7646914923943848,0.71235940359391,80.49748743718592,60.49828178694158,0.4935008385502339
5,ConvNN,10_wt_avg,0.5519800370931626,0.7291053307056428,0.7951243894378686,0.693490723703612,0.7373359501807664,0.7328860872523698,0.7554059625378008,0.6947600082775133,80.49748743718592,60.49828178694158,0.4695473110555456
5,ConvNN,11_wt_avg,0.5481433939933777,0.7316631692647934,0.8203023942179276,0.6542076836982841,0.7161082818157609,0.5732419395396957,0.7538945835544492,0.682137455942689,80.49748743718592,60.49828178694158,0.4650354884615931
5,ConvNN,12_wt_avg,0.5378611379861832,0.734265125989914,0.7931171173686149,0.6821173005284588,0.7357841865946834,0.7309580700572814,0.752989998132777,0.6947881875010876,80.49748743718592,60.49828178694158,0.46218289358310277
5,ConvNN,13_wt_avg,0.5409416085481644,0.7357165521383285,0.8155829022306922,0.6739253086473092,0.7070377001272967,0.7752580761555898,0.7495212075749477,0.7114862703909687,80.49748743718592,60.49828178694158,0.4794672640259625
5,ConvNN,14_wt_avg,0.5530431586503983,0.7308850055932998,0.7913267309734846,0.6782091978076785,0.7330512863277872,0.740949910319225,0.7529940354865131,0.6981347740855666,80.49748743718592,60.49828178694158,0.46430710093527666
5,ConvNN,15_wt_avg,0.5436932396888733,0.7312153738737106,0.7893930490375564,0.6718199326446748,0.7114887774016487,0.7577276246887814,0.7404680993248833,0.7023082745496848,80.49748743718592,60.49828178694158,0.458941091073207
5,ConvNN,16_wt_avg,0.5429352807998657,0.7303105705976487,0.7885363878806779,0.6769919136195349,0.7383519218975069,0.718373627062705,0.754803941208132,0.6876269357330133,80.49748743718592,60.49828178694158,0.4489721475373935
5,ConvNN,17_wt_avg,0.5549911481142044,0.7304211807250977,0.7892422039155708,0.6326411631951672,0.7097094672557124,0.7121447037229329,0.7399787623702617,0.6605539493705175,80.49748743718592,60.49828178694158,0.41668038709241106
5,ConvNN,18_wt_avg,0.5365783703327179,0.7357294458150864,0.8009093149386391,0.6699449729819013,0.7352731592850141,0.7380452160197462,0.7585378964313025,0.6881993974157641,80.49748743718592,60.49828178694158,0.45698136370135883
5,ConvNN,19_wt_avg,0.5687423133850098,0.7197913002967835,0.7858030636318165,0.6651302903703881,0.7116400803771962,0.7357828771412761,0.7351320680554003,0.6872444056638363,80.49748743718592,60.49828178694158,0.44025503176218256
5,ConvNN,20_wt_avg,0.5444330203533172,0.7369487732648848,0.7988567905228414,0.7031836529259209,0.7420816389915951,0.732937991315477,0.7591970078516604,0.7018337107242937,80.49748743718592,60.49828178694158,0.4782349531733246
5,ConvNN,21_wt_avg,0.5298232197761537,0.7575232100486755,0.8085829274731638,0.7226111137026844,0.7623807828466181,0.7559667349024536,0.7783437042471159,0.728133454829497,80.49748743718592,60.49828178694158,0.514307444419147
5,ConvNN,22_wt_avg,0.5471014821529389,0.7303045827150345,0.8038453536081769,0.6758023098663358,0.7116465717087499,0.7631684679895717,0.746749936951515,0.7064838818014326,80.49748743718592,60.49828178694158,0.47093342287632706
5,ConvNN,23_wt_avg,0.5380485400557518,0.7224591094255448,0.7908091153599578,0.650792854320351,0.7276502801851715,0.7156574272144314,0.7508389927282028,0.6664657008647306,80.49748743718592,60.49828178694158,0.4317225472603968
5,ConvNN,24_wt_avg,0.5381400018930436,0.7296107834577561,0.7838930828421041,0.6863574597482708,0.7324343481126725,0.7363881591534716,0.7471267227821027,0.6995025659599675,80.49748743718592,60.49828178694158,0.459457156921082
5,ConvNN,25_wt_avg,0.5457840263843536,0.7346957892179489,0.7992398217906193,0.6773768438309946,0.7450872202042815,0.7363196738752897,0.7622716427405978,0.6924127644766075,80.49748743718592,60.49828178694158,0.46698623118448845
5,ConvNN,26_wt_avg,0.5477972912788391,0.7352026253938675,0.7961127161611977,0.6896267540225601,0.7305813695766751,0.7427148101208138,0.7535386348877601,0.705079682123798,80.49748743718592,60.49828178694158,0.4707654261351795
5,ConvNN,27_wt_avg,0.5470540177822113,0.7349829632043839,0.7714261723715288,0.7051491063287687,0.6125685463288727,0.7283377676161182,0.7358674348248194,0.7016091499591299,80.49748743718592,60.49828178694158,0.45129313052044767
5,ConvNN,28_wt_avg,0.5414926898479462,0.7383282721042634,0.7945688425761877,0.6913472677886517,0.7368669270875559,0.7369698455083536,0.7569956474829436,0.7051986449134005,80.49748743718592,60.49828178694158,0.47214825957867373
5,ConvNN,29_wt_avg,0.5647945418953896,0.714231967329979,0.7681826639225962,0.6833265398981464,0.5842549180635495,0.735516303896662,0.7204841145040675,0.6907121770541607,80.49748743718592,60.49828178694158,0.44076643852765995
5,ConvNN,30_wt_avg,0.5470400774478913,0.7191235673427581,0.7914459084197939,0.6664330464360786,0.7221483730311022,0.715208157630838,0.7432890598795158,0.677531991016498,80.49748743718592,60.49828178694158,0.43551059071601017
5,ConvNN,wt_avg,0.5450923945804437,0.732370652139187,0.7972599381893188,0.6761012825483611,0.7205272726050861,0.7271239522354498,0.7518291108763393,0.6930636566219849,80.49748743718597,60.49828178694157,0.4609065524758186
